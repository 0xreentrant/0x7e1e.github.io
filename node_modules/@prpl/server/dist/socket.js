if ('WebSocket' in window) {
    const { protocol: originalProtocol, host, pathname } = window?.location || {};
    const protocol = originalProtocol === 'http:' ? 'ws://' : 'wss://';
    const address = `${protocol}${host}${pathname}/ws`;
    const socket = new WebSocket(address);
    socket.onmessage = ({ data: href }) => {
        if (!href) {
            return;
        }
        fetch(href)
            .then((response) => {
            if (href === '/' || href?.endsWith('.html')) {
                return response?.text()?.then((html) => {
                    const { origin, pathname } = window.location || {};
                    sessionStorage?.setItem(`prpl-${origin}${href}`, html);
                    if (pathname === href) {
                        const pseudoAnchor = document?.createElement('a');
                        pseudoAnchor.href = href;
                        document.querySelector('main')?.appendChild(pseudoAnchor);
                        pseudoAnchor?.click();
                    }
                });
            }
            if (href?.endsWith('.css')) {
                const styleElements = document.querySelectorAll('[rel="stylesheet"]');
                styleElements.forEach((styleElement) => {
                    styleElement?.parentNode?.replaceChild(styleElement, styleElement);
                });
                return;
            }
            window.location.reload();
        })
            .catch((error) => console.warn(`[PRPL] Failed to refresh resource '${href}'. Error:`, error));
    };
}
